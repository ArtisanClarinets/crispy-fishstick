; ═══════════════════════════════════════════════════════════════════════
;  Vantus Systems - Supervisor Configuration
; ═══════════════════════════════════════════════════════════════════════
;
;  Alternative process manager configuration using Supervisor
;  
;  Installation location: /etc/supervisor/conf.d/vantus.conf
;
;  NOTE: This is provided as an alternative to systemd. The bootstrap
;        script uses systemd by default. Use supervisor if you prefer
;        it over systemd for process management.
;
;  Installation:
;    1. Install supervisor: apt-get install supervisor
;    2. Copy this file: cp config/supervisor/vantus.conf /etc/supervisor/conf.d/
;    3. Reload supervisor: supervisorctl reread && supervisorctl update
;    4. Start the app: supervisorctl start vantus
;
; ═══════════════════════════════════════════════════════════════════════

[program:vantus]
; Application directory
directory=/var/www/vantus

; Start command - build fresh and run the production Next.js server so SSR routes stay live
command=/bin/sh -c 'npm run build && exec npm start -- --hostname 0.0.0.0 --port 3005'

; Environment variables
; NOTE: Sensitive values should be loaded from /etc/default/vantus
environment=NODE_ENV="production",PORT="3005",HOSTNAME="0.0.0.0",PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
; Process management
user=vantus
autostart=true
autorestart=true
startretries=3
stopsignal=INT
stopwaitsecs=20
killasgroup=true
stopasgroup=true

; Priority (higher = starts later, stops earlier)
priority=999

; Logging configuration
stdout_logfile=/var/log/vantus/supervisor.stdout.log
stderr_logfile=/var/log/vantus/supervisor.stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
stdout_capture_maxbytes=1MB
stderr_capture_maxbytes=1MB

; Redirect stderr to stdout (so it goes to stdout_logfile)
redirect_stderr=true

; Log events
stdout_events_enabled=true
stderr_events_enabled=true
